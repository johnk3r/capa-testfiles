{"meta": {"timestamp": "2023-03-22T10:37:54.274766", "version": "5.0.0", "argv": ["tests/data/dotnet/1c444ebeba24dcba8628b7dfe5fec7c6.exe_", "--json"], "sample": {"md5": "1c444ebeba24dcba8628b7dfe5fec7c6", "sha1": "ebdec120fbbdbff28ebd6accc85d05f7ccabf461", "sha256": "a9f9e5a30cc858dc135ec428cdd68cb06143732e5c62c4dc4b359c8abc11d74b", "path": "tests/data/dotnet/1c444ebeba24dcba8628b7dfe5fec7c6.exe_"}, "analysis": {"format": "dotnet", "arch": "i386", "os": "windows", "extractor": "DnfileFeatureExtractor", "rules": ["/home/user/code-personal/capa/rules"], "base_address": {"type": "no address"}, "layout": {"functions": [{"address": {"type": "dn token", "value": 100663297}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663298}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663299}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663300}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663301}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663302}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663303}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663304}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663305}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663306}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663307}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663308}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663309}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663310}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663311}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663312}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663313}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663314}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663315}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663316}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663317}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663318}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663319}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663320}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663321}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663322}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663323}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663324}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663325}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663326}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663327}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663328}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663329}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663330}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663331}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663332}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663333}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663334}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663335}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663336}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663337}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663338}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663339}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663340}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663341}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663342}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663343}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663344}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663345}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663346}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663347}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663348}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663349}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663350}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663351}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663352}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663353}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663354}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663355}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663356}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663357}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663358}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663359}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663360}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663361}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663362}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663363}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663364}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663364}}]}, {"address": {"type": "dn token", "value": 100663365}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663366}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663367}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663368}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663369}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663370}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663371}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663372}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663373}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663374}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663375}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663376}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663377}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663378}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663379}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663380}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663381}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663382}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663383}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663384}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663385}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663386}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663387}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663388}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663389}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663390}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663391}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663392}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663393}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663394}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663394}}]}, {"address": {"type": "dn token", "value": 100663395}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663395}}]}, {"address": {"type": "dn token", "value": 100663396}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663397}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663398}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663399}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663400}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663401}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663402}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663403}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663404}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663405}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663406}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663407}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663408}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663409}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663410}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663411}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663412}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663419}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663424}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663425}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663425}}]}, {"address": {"type": "dn token", "value": 100663426}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663427}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663428}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663428}}]}, {"address": {"type": "dn token", "value": 100663429}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663429}}]}, {"address": {"type": "dn token", "value": 100663430}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663431}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663431}}]}, {"address": {"type": "dn token", "value": 100663432}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663433}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663434}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663434}}]}, {"address": {"type": "dn token", "value": 100663435}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663436}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663436}}]}, {"address": {"type": "dn token", "value": 100663437}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663438}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663439}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663439}}]}, {"address": {"type": "dn token", "value": 100663440}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663441}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663441}}]}, {"address": {"type": "dn token", "value": 100663442}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663443}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663444}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663444}}]}, {"address": {"type": "dn token", "value": 100663445}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663445}}]}, {"address": {"type": "dn token", "value": 100663446}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663447}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663448}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663449}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663450}, "matched_basic_blocks": [{"address": {"type": "dn token", "value": 100663450}}]}, {"address": {"type": "dn token", "value": 100663451}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663452}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663453}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663454}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663455}, "matched_basic_blocks": []}, {"address": {"type": "dn token", "value": 100663456}, "matched_basic_blocks": []}]}, "feature_counts": {"file": 1243, "functions": [{"address": {"type": "dn token", "value": 100663297}, "count": 8}, {"address": {"type": "dn token", "value": 100663298}, "count": 8}, {"address": {"type": "dn token", "value": 100663299}, "count": 28}, {"address": {"type": "dn token", "value": 100663300}, "count": 17}, {"address": {"type": "dn token", "value": 100663301}, "count": 15}, {"address": {"type": "dn token", "value": 100663302}, "count": 40}, {"address": {"type": "dn token", "value": 100663303}, "count": 5}, {"address": {"type": "dn token", "value": 100663304}, "count": 15}, {"address": {"type": "dn token", "value": 100663305}, "count": 15}, {"address": {"type": "dn token", "value": 100663306}, "count": 15}, {"address": {"type": "dn token", "value": 100663307}, "count": 15}, {"address": {"type": "dn token", "value": 100663308}, "count": 15}, {"address": {"type": "dn token", "value": 100663309}, "count": 15}, {"address": {"type": "dn token", "value": 100663310}, "count": 15}, {"address": {"type": "dn token", "value": 100663311}, "count": 9}, {"address": {"type": "dn token", "value": 100663312}, "count": 32}, {"address": {"type": "dn token", "value": 100663313}, "count": 14}, {"address": {"type": "dn token", "value": 100663314}, "count": 13}, {"address": {"type": "dn token", "value": 100663315}, "count": 13}, {"address": {"type": "dn token", "value": 100663316}, "count": 14}, {"address": {"type": "dn token", "value": 100663317}, "count": 10}, {"address": {"type": "dn token", "value": 100663318}, "count": 13}, {"address": {"type": "dn token", "value": 100663319}, "count": 10}, {"address": {"type": "dn token", "value": 100663320}, "count": 10}, {"address": {"type": "dn token", "value": 100663321}, "count": 9}, {"address": {"type": "dn token", "value": 100663322}, "count": 8}, {"address": {"type": "dn token", "value": 100663323}, "count": 29}, {"address": {"type": "dn token", "value": 100663324}, "count": 15}, {"address": {"type": "dn token", "value": 100663325}, "count": 28}, {"address": {"type": "dn token", "value": 100663326}, "count": 8}, {"address": {"type": "dn token", "value": 100663327}, "count": 14}, {"address": {"type": "dn token", "value": 100663328}, "count": 267}, {"address": {"type": "dn token", "value": 100663329}, "count": 8}, {"address": {"type": "dn token", "value": 100663330}, "count": 19}, {"address": {"type": "dn token", "value": 100663331}, "count": 18}, {"address": {"type": "dn token", "value": 100663332}, "count": 16}, {"address": {"type": "dn token", "value": 100663333}, "count": 11}, {"address": {"type": "dn token", "value": 100663334}, "count": 10}, {"address": {"type": "dn token", "value": 100663335}, "count": 11}, {"address": {"type": "dn token", "value": 100663336}, "count": 33}, {"address": {"type": "dn token", "value": 100663337}, "count": 14}, {"address": {"type": "dn token", "value": 100663338}, "count": 24}, {"address": {"type": "dn token", "value": 100663339}, "count": 32}, {"address": {"type": "dn token", "value": 100663340}, "count": 22}, {"address": {"type": "dn token", "value": 100663341}, "count": 9}, {"address": {"type": "dn token", "value": 100663342}, "count": 11}, {"address": {"type": "dn token", "value": 100663343}, "count": 33}, {"address": {"type": "dn token", "value": 100663344}, "count": 12}, {"address": {"type": "dn token", "value": 100663345}, "count": 15}, {"address": {"type": "dn token", "value": 100663346}, "count": 9}, {"address": {"type": "dn token", "value": 100663347}, "count": 11}, {"address": {"type": "dn token", "value": 100663348}, "count": 33}, {"address": {"type": "dn token", "value": 100663349}, "count": 13}, {"address": {"type": "dn token", "value": 100663350}, "count": 15}, {"address": {"type": "dn token", "value": 100663351}, "count": 9}, {"address": {"type": "dn token", "value": 100663352}, "count": 11}, {"address": {"type": "dn token", "value": 100663353}, "count": 33}, {"address": {"type": "dn token", "value": 100663354}, "count": 12}, {"address": {"type": "dn token", "value": 100663355}, "count": 15}, {"address": {"type": "dn token", "value": 100663356}, "count": 9}, {"address": {"type": "dn token", "value": 100663357}, "count": 11}, {"address": {"type": "dn token", "value": 100663358}, "count": 33}, {"address": {"type": "dn token", "value": 100663359}, "count": 12}, {"address": {"type": "dn token", "value": 100663360}, "count": 15}, {"address": {"type": "dn token", "value": 100663361}, "count": 13}, {"address": {"type": "dn token", "value": 100663362}, "count": 12}, {"address": {"type": "dn token", "value": 100663363}, "count": 15}, {"address": {"type": "dn token", "value": 100663364}, "count": 16}, {"address": {"type": "dn token", "value": 100663365}, "count": 15}, {"address": {"type": "dn token", "value": 100663366}, "count": 9}, {"address": {"type": "dn token", "value": 100663367}, "count": 11}, {"address": {"type": "dn token", "value": 100663368}, "count": 33}, {"address": {"type": "dn token", "value": 100663369}, "count": 12}, {"address": {"type": "dn token", "value": 100663370}, "count": 15}, {"address": {"type": "dn token", "value": 100663371}, "count": 9}, {"address": {"type": "dn token", "value": 100663372}, "count": 11}, {"address": {"type": "dn token", "value": 100663373}, "count": 11}, {"address": {"type": "dn token", "value": 100663374}, "count": 33}, {"address": {"type": "dn token", "value": 100663375}, "count": 14}, {"address": {"type": "dn token", "value": 100663376}, "count": 15}, {"address": {"type": "dn token", "value": 100663377}, "count": 9}, {"address": {"type": "dn token", "value": 100663378}, "count": 22}, {"address": {"type": "dn token", "value": 100663379}, "count": 29}, {"address": {"type": "dn token", "value": 100663380}, "count": 15}, {"address": {"type": "dn token", "value": 100663381}, "count": 9}, {"address": {"type": "dn token", "value": 100663382}, "count": 11}, {"address": {"type": "dn token", "value": 100663383}, "count": 22}, {"address": {"type": "dn token", "value": 100663384}, "count": 16}, {"address": {"type": "dn token", "value": 100663385}, "count": 16}, {"address": {"type": "dn token", "value": 100663386}, "count": 15}, {"address": {"type": "dn token", "value": 100663387}, "count": 9}, {"address": {"type": "dn token", "value": 100663388}, "count": 22}, {"address": {"type": "dn token", "value": 100663389}, "count": 12}, {"address": {"type": "dn token", "value": 100663390}, "count": 8}, {"address": {"type": "dn token", "value": 100663391}, "count": 15}, {"address": {"type": "dn token", "value": 100663392}, "count": 9}, {"address": {"type": "dn token", "value": 100663393}, "count": 22}, {"address": {"type": "dn token", "value": 100663394}, "count": 14}, {"address": {"type": "dn token", "value": 100663395}, "count": 40}, {"address": {"type": "dn token", "value": 100663396}, "count": 22}, {"address": {"type": "dn token", "value": 100663397}, "count": 9}, {"address": {"type": "dn token", "value": 100663398}, "count": 22}, {"address": {"type": "dn token", "value": 100663399}, "count": 12}, {"address": {"type": "dn token", "value": 100663400}, "count": 14}, {"address": {"type": "dn token", "value": 100663401}, "count": 13}, {"address": {"type": "dn token", "value": 100663402}, "count": 14}, {"address": {"type": "dn token", "value": 100663403}, "count": 13}, {"address": {"type": "dn token", "value": 100663404}, "count": 23}, {"address": {"type": "dn token", "value": 100663405}, "count": 18}, {"address": {"type": "dn token", "value": 100663406}, "count": 13}, {"address": {"type": "dn token", "value": 100663407}, "count": 15}, {"address": {"type": "dn token", "value": 100663408}, "count": 9}, {"address": {"type": "dn token", "value": 100663409}, "count": 4}, {"address": {"type": "dn token", "value": 100663410}, "count": 12}, {"address": {"type": "dn token", "value": 100663411}, "count": 39}, {"address": {"type": "dn token", "value": 100663412}, "count": 9}, {"address": {"type": "dn token", "value": 100663419}, "count": 8}, {"address": {"type": "dn token", "value": 100663424}, "count": 8}, {"address": {"type": "dn token", "value": 100663425}, "count": 83}, {"address": {"type": "dn token", "value": 100663426}, "count": 17}, {"address": {"type": "dn token", "value": 100663427}, "count": 20}, {"address": {"type": "dn token", "value": 100663428}, "count": 41}, {"address": {"type": "dn token", "value": 100663429}, "count": 41}, {"address": {"type": "dn token", "value": 100663430}, "count": 17}, {"address": {"type": "dn token", "value": 100663431}, "count": 34}, {"address": {"type": "dn token", "value": 100663432}, "count": 24}, {"address": {"type": "dn token", "value": 100663433}, "count": 21}, {"address": {"type": "dn token", "value": 100663434}, "count": 61}, {"address": {"type": "dn token", "value": 100663435}, "count": 9}, {"address": {"type": "dn token", "value": 100663436}, "count": 35}, {"address": {"type": "dn token", "value": 100663437}, "count": 10}, {"address": {"type": "dn token", "value": 100663438}, "count": 9}, {"address": {"type": "dn token", "value": 100663439}, "count": 12}, {"address": {"type": "dn token", "value": 100663440}, "count": 39}, {"address": {"type": "dn token", "value": 100663441}, "count": 34}, {"address": {"type": "dn token", "value": 100663442}, "count": 9}, {"address": {"type": "dn token", "value": 100663443}, "count": 9}, {"address": {"type": "dn token", "value": 100663444}, "count": 23}, {"address": {"type": "dn token", "value": 100663445}, "count": 23}, {"address": {"type": "dn token", "value": 100663446}, "count": 113}, {"address": {"type": "dn token", "value": 100663447}, "count": 33}, {"address": {"type": "dn token", "value": 100663448}, "count": 33}, {"address": {"type": "dn token", "value": 100663449}, "count": 15}, {"address": {"type": "dn token", "value": 100663450}, "count": 27}, {"address": {"type": "dn token", "value": 100663451}, "count": 39}, {"address": {"type": "dn token", "value": 100663452}, "count": 10}, {"address": {"type": "dn token", "value": 100663453}, "count": 9}, {"address": {"type": "dn token", "value": 100663454}, "count": 14}, {"address": {"type": "dn token", "value": 100663455}, "count": 15}, {"address": {"type": "dn token", "value": 100663456}, "count": 36}]}, "library_functions": []}}, "rules": {"create process on Windows": {"meta": {"name": "create process on Windows", "namespace": "host-interaction/process/create", "authors": ["moritz.raabe@mandiant.com"], "scope": "basic block", "attack": [], "mbc": [{"parts": ["Process", "Create Process"], "objective": "Process", "behavior": "Create Process", "method": "", "id": "C0017"}], "references": [], "examples": ["9324D1A8AE37A36AE560C37448C9705A:0x406DB0", "Practical Malware Analysis Lab 01-04.exe_:0x4011FC", "692f7fd6d198e804d6af98eb9e390d61:0x6000003"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create process on Windows\n    namespace: host-interaction/process/create\n    authors:\n      - moritz.raabe@mandiant.com\n    scope: basic block\n    mbc:\n      - Process::Create Process [C0017]\n    examples:\n      - 9324D1A8AE37A36AE560C37448C9705A:0x406DB0\n      - Practical Malware Analysis Lab 01-04.exe_:0x4011FC\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\n  features:\n    - or:\n      - api: kernel32.WinExec\n      - api: kernel32.CreateProcess\n      - api: shell32.ShellExecute\n      - api: shell32.ShellExecuteEx\n      - api: advapi32.CreateProcessAsUser\n      - api: advapi32.CreateProcessWithLogon\n      - api: advapi32.CreateProcessWithToken\n      - api: kernel32.CreateProcessInternal\n      - api: ntdll.NtCreateUserProcess\n      - api: ntdll.NtCreateProcess\n      - api: ntdll.NtCreateProcessEx\n      - api: ntdll.ZwCreateProcess\n      - api: ZwCreateProcessEx\n      - api: ntdll.ZwCreateUserProcess\n      - api: ntdll.RtlCreateUserProcess\n      - api: System.Diagnostics.Process::Start\n", "matches": [[{"type": "dn token", "value": 100663364}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.WinExec"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.ShellExecute"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.ShellExecuteEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessAsUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessWithLogon"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessWithToken"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateProcessInternal"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateUserProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateProcessEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateProcessEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateUserProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.RtlCreateUserProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Diagnostics.Process::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663364, 6]}], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663425}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.WinExec"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.ShellExecute"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.ShellExecuteEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessAsUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessWithLogon"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessWithToken"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateProcessInternal"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateUserProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateProcessEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateProcessEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateUserProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.RtlCreateUserProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Diagnostics.Process::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 178]}], "captures": {}}], "locations": [], "captures": {}}]]}, "create or open registry key": {"meta": {"name": "create or open registry key", "authors": ["michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "basic block", "attack": [], "mbc": [{"parts": ["Operating System", "Registry", "Create Registry Key"], "objective": "Operating System", "behavior": "Registry", "method": "Create Registry Key", "id": "C0036.004"}, {"parts": ["Operating System", "Registry", "Open Registry Key"], "objective": "Operating System", "behavior": "Registry", "method": "Open Registry Key", "id": "C0036.003"}], "references": [], "examples": ["Practical Malware Analysis Lab 03-02.dll_:0x10004706", "Practical Malware Analysis Lab 11-01.exe_:0x401000", "493167E85E45363D09495D0841C30648:0x404D60", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E", "692f7fd6d198e804d6af98eb9e390d61:0x6000003"], "description": "", "lib": true, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create or open registry key\n    authors:\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    lib: true\n    scope: basic block\n    mbc:\n      - Operating System::Registry::Create Registry Key [C0036.004]\n      - Operating System::Registry::Open Registry Key [C0036.003]\n    examples:\n      - Practical Malware Analysis Lab 03-02.dll_:0x10004706\n      - Practical Malware Analysis Lab 11-01.exe_:0x401000\n      - 493167E85E45363D09495D0841C30648:0x404D60\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x4045F2\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x40433E\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\n  features:\n    - or:\n      - api: advapi32.RegOpenKey\n      - api: advapi32.RegOpenKeyEx\n      - api: advapi32.RegCreateKey\n      - api: advapi32.RegCreateKeyEx\n      - api: advapi32.RegOpenCurrentUser\n      - api: advapi32.RegOpenKeyTransacted\n      - api: advapi32.RegOpenUserClassesRoot\n      - api: advapi32.RegCreateKeyTransacted\n      - api: ZwOpenKey\n      - api: ZwOpenKeyEx\n      - api: ZwCreateKey\n      - api: ZwOpenKeyTransacted\n      - api: ZwOpenKeyTransactedEx\n      - api: ZwCreateKeyTransacted\n      - api: NtOpenKey\n      - api: NtCreateKey\n      - api: SHRegOpenUSKey\n      - api: SHRegCreateUSKey\n      - api: RtlCreateRegistryKey\n      - api: Microsoft.Win32.RegistryKey::OpenSubKey\n      - api: Microsoft.Win32.RegistryKey::OpenBaseKey\n      - api: Microsoft.Win32.RegistryKey::OpenRemoteBaseKey\n      - api: Microsoft.Win32.RegistryKey::CreateSubKey\n", "matches": [[{"type": "dn token", "value": 100663394}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenCurrentUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenUserClassesRoot"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegOpenUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegCreateUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663394, 11]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663395}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenCurrentUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenUserClassesRoot"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegOpenUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegCreateUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663395, 30]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "create thread": {"meta": {"name": "create thread", "namespace": "host-interaction/thread/create", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com", "joakim@intezer.com", "anushka.virgaonkar@mandiant.com"], "scope": "basic block", "attack": [], "mbc": [{"parts": ["Process", "Create Thread"], "objective": "Process", "behavior": "Create Thread", "method": "", "id": "C0038"}], "references": [], "examples": ["946A99F36A46D335DEC080D9A4371940:0x10001DA0", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x408020"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create thread\n    namespace: host-interaction/thread/create\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - joakim@intezer.com\n      - anushka.virgaonkar@mandiant.com\n    scope: basic block\n    mbc:\n      - Process::Create Thread [C0038]\n    examples:\n      - 946A99F36A46D335DEC080D9A4371940:0x10001DA0\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x408020\n  features:\n    - or:\n      - and:\n        - os: windows\n        - or:\n          - api: kernel32.CreateThread\n          - api: _beginthread\n          - api: _beginthreadex\n          - api: PsCreateSystemThread\n          - api: SHCreateThread\n          - api: SHCreateThreadWithHandle\n          - api: kernel32.CreateRemoteThread\n          - api: kernel32.CreateRemoteThreadEx\n          - api: RtlCreateUserThread\n          - api: ntdll.NtCreateThread\n          - api: ntdll.NtCreateThreadEx\n          - api: ntdll.ZwCreateThread\n          - api: ntdll.ZwCreateThreadEx\n      - and:\n        - os: linux\n        - api: pthread_create\n      - and:\n        - api: System.Threading.Thread::Start\n        - optional:\n          - api: System.Threading.Thread::ctor\n", "matches": [[{"type": "dn token", "value": 100663425}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "pthread_create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 224]}, {"type": "dn token offset", "value": [100663425, 269]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 202]}, {"type": "dn token offset", "value": [100663425, 247]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthreadex"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "PsCreateSystemThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThreadWithHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateUserThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663431}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "pthread_create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663431, 74]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663431, 58]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthreadex"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "PsCreateSystemThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThreadWithHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateUserThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663436}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "pthread_create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663436, 84]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663436, 47]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthreadex"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "PsCreateSystemThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThreadWithHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateUserThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663444}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "pthread_create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663444, 65]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663444, 48]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthreadex"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "PsCreateSystemThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThreadWithHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateUserThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663445}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "pthread_create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663445, 65]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663445, 48]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthreadex"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "PsCreateSystemThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThreadWithHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateUserThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663450}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "pthread_create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663450, 80]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663450, 48]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_beginthreadex"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "PsCreateSystemThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateThreadWithHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateRemoteThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateUserThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwCreateThreadEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "reference absolute stream path on Windows": {"meta": {"name": "reference absolute stream path on Windows", "namespace": "host-interaction/file-system", "authors": ["blas.kojusner@mandiant.com", "william.ballenthin@mandiant.com"], "scope": "basic block", "attack": [], "mbc": [], "references": ["https://learn.microsoft.com/en-us/windows/win32/fileio/file-streams"], "examples": ["51828683DC26BFABD3994494099AE97D:0x11A9"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: reference absolute stream path on Windows\n    namespace: host-interaction/file-system\n    authors:\n      - blas.kojusner@mandiant.com\n      - william.ballenthin@mandiant.com\n    scope: basic block\n    references:\n      - https://learn.microsoft.com/en-us/windows/win32/fileio/file-streams\n    examples:\n      - 51828683DC26BFABD3994494099AE97D:0x11A9\n  features:\n    - and:\n      - string: /^(..\\?\\\\)?([\\w]\\:|\\\\)(\\\\+((?![\\<\\>\\\"\\/\\|\\*\\?\\:\\\\])[\\x20-\\x5B\\x5D-\\x7E])+)+(\\:\\$?([a-zA-Z0-9_]+))?/\n        # ^(..\\?\\\\)? -> Check for path starting with \"\\\\?\\\"\n        # ([\\w]\\:|\\\\) -> Check for absolute path beginning\n        # (\\\\+((?![\\<\\>\\\"\\/\\|\\*\\?\\:\\\\])[\\x20-\\x5B\\x5D-\\x7E])+)+ -> Check for valid path and filename\n        #   \\\\+ -> Check for at least one backslash path separator\n        #   (?![\\<\\>\\\"\\/\\|\\*\\?\\:\\\\]) -> path component must not start with <, >, \", ...\n        #   [\\x20-\\x5B\\x5D-\\x7E] -> path component must be printable ASCII, except backslash path separator\n        # : -> Check for start of stream filename\n        # \\$?([a-zA-Z0-9_]+))? -> Check for valid stream filename\n        ### Example Matches:\n        ### \\\\\\\\server\\share\\\\file:stream\n        ### \\\\\\\\server\\share\\dir.ext\\\\file.ext:stream \n        ### \\\\\\\\server\\share\\dir.ext\\\\file.tar.gz:stream\n        ### \\\\\\\\server\\share\\dir.ext\\\\file:stream.tar.gz\n        ### \\\\\\\\server\\share\\dir\\\\file.ext:stream.ext\n        ### \\\\\\\\?\\C:\\dir1\\dir2\\\\file:stream\n        ### C:\\dir\\\\file:stream.ext\n        ### C:\\dir\\\\file:}{+,.';[]-=-0987654321`~!@#$%^&()_+-.ext\n", "matches": [[{"type": "dn token", "value": 100663425}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "regex", "regex": "/^(..\\?\\\\)?([\\w]\\:|\\\\)(\\\\+((?![\\<\\>\\\"\\/\\|\\*\\?\\:\\\\])[\\x20-\\x5B\\x5D-\\x7E])+)+(\\:\\$?([a-zA-Z0-9_]+))?/"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 69]}], "captures": {"C:\\Windows\\System32\\cmd.exe": [{"type": "dn token offset", "value": [100663425, 69]}]}}], "locations": [], "captures": {}}]]}, "suspend thread": {"meta": {"name": "suspend thread", "namespace": "host-interaction/thread/suspend", "authors": ["0x534a@mailbox.org", "anushka.virgaonkar@mandiant.com"], "scope": "basic block", "attack": [], "mbc": [{"parts": ["Process", "Suspend Thread"], "objective": "Process", "behavior": "Suspend Thread", "method": "", "id": "C0055"}], "references": [], "examples": ["787cbc8a6d1bc58ea169e51e1ad029a637f22560660cc129ab8a099a745bd50e:0x502f4c"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: suspend thread\n    namespace: host-interaction/thread/suspend\n    authors:\n      - 0x534a@mailbox.org\n      - anushka.virgaonkar@mandiant.com\n    scope: basic block\n    mbc:\n      - Process::Suspend Thread [C0055]\n    examples:\n      - 787cbc8a6d1bc58ea169e51e1ad029a637f22560660cc129ab8a099a745bd50e:0x502f4c\n  features:\n    - or:\n      - api: kernel32.SuspendThread\n      - api: ntdll.NtSuspendThread\n      - api: ntdll.ZwSuspendThread\n      - api: System.Threading.Thread::Suspend\n      - api: System.Threading.Thread::Sleep\n", "matches": [[{"type": "dn token", "value": 100663428}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.SuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Suspend"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Sleep"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663428, 133]}, {"type": "dn token offset", "value": [100663428, 120]}], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663429}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.SuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Suspend"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Sleep"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663429, 120]}, {"type": "dn token offset", "value": [100663429, 133]}], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663434}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.SuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Suspend"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Sleep"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663434, 294]}, {"type": "dn token offset", "value": [100663434, 285]}, {"type": "dn token offset", "value": [100663434, 5]}, {"type": "dn token offset", "value": [100663434, 187]}], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663439}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.SuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Suspend"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Sleep"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663439, 1]}], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663441}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.SuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.ZwSuspendThread"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Suspend"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Threading.Thread::Sleep"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663441, 105]}], "captures": {}}], "locations": [], "captures": {}}]]}, "encode data using Base64": {"meta": {"name": "encode data using Base64", "namespace": "data-manipulation/encoding/base64", "authors": ["moritz.raabe@mandiant.com", "anushka.virgaonkar@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [{"parts": ["Defense Evasion", "Obfuscated Files or Information"], "tactic": "Defense Evasion", "technique": "Obfuscated Files or Information", "subtechnique": "", "id": "T1027"}], "mbc": [{"parts": ["Defense Evasion", "Obfuscated Files or Information", "Encoding-Standard Algorithm"], "objective": "Defense Evasion", "behavior": "Obfuscated Files or Information", "method": "Encoding-Standard Algorithm", "id": "E1027.m02"}, {"parts": ["Data", "Encode Data", "Base64"], "objective": "Data", "behavior": "Encode Data", "method": "Base64", "id": "C0026.001"}], "references": [], "examples": ["BFB9B5391A13D0AFD787E87AB90F14F5:0x1314889C", "074072B261FC27B65C72671F13510C05:0x100049B2", "5DB2D2BE20D59AA0BE6709A6850F1775:0x18001CC30", "08AC667C65D36D6542917655571E61C8:0x406EAA"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: encode data using Base64\n    namespace: data-manipulation/encoding/base64\n    authors:\n      - moritz.raabe@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    att&ck:\n      - Defense Evasion::Obfuscated Files or Information [T1027]\n    mbc:\n      - Defense Evasion::Obfuscated Files or Information::Encoding-Standard Algorithm [E1027.m02]\n      - Data::Encode Data::Base64 [C0026.001]\n    examples:\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x1314889C\n      - 074072B261FC27B65C72671F13510C05:0x100049B2\n      - 5DB2D2BE20D59AA0BE6709A6850F1775:0x18001CC30\n      - 08AC667C65D36D6542917655571E61C8:0x406EAA\n  features:\n    - or:\n      - and:\n        - mnemonic: shl\n        - mnemonic: shr\n        - number: 0x3F = modulo 64\n        - or:\n          - number: 0x3D = '='\n          - number: 0x3D3D = '=='\n        - match: contain loop\n        - optional:\n          - number: 2\n          - number: 3\n          - number: 4\n          - number: 6\n          - number: 0xF\n          - string: \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\n      - api: System.Convert::ToBase64String\n      - api: System.Convert::ToBase64CharArray\n      - api: System.Convert::TryToBase64Chars\n", "matches": [[{"type": "dn token", "value": 100663323}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663323, 48]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663336}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663336, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663336, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663336, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663336, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663336, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663340}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663340, 23]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663343}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663343, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663343, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663343, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663343, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663343, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663348}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663348, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663348, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663348, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663348, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663348, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663353}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663353, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663353, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663353, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663353, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663353, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663358}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663358, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663358, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663358, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663358, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663358, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663368}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663368, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663368, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663368, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663368, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663368, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663374}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663374, 64]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663374, 30]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663374, 39]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663374, 47]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663374, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663396}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663396, 23]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663456}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663456, 62]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::ToBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryToBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shl"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "mnemonic", "mnemonic": "shr"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 63, "description": "modulo 64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 61, "description": "'='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15677, "description": "'=='"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "number", "number": 2}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663456, 29]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 3}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663456, 42]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "number", "number": 4}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663456, 50]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 6}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 15}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "hash data with MD5": {"meta": {"name": "hash data with MD5", "namespace": "data-manipulation/hashing/md5", "authors": ["moritz.raabe@mandiant.com", "anushka.virgaonkar@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Cryptography", "Cryptographic Hash", "MD5"], "objective": "Cryptography", "behavior": "Cryptographic Hash", "method": "MD5", "id": "C0029.001"}], "references": ["https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp"], "examples": ["Practical Malware Analysis Lab 05-01.dll_:0x100108ED"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: hash data with MD5\n    namespace: data-manipulation/hashing/md5\n    authors:\n      - moritz.raabe@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - Cryptography::Cryptographic Hash::MD5 [C0029.001]\n    references:\n      - https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp\n    examples:\n      - Practical Malware Analysis Lab 05-01.dll_:0x100108ED\n  features:\n    - or:\n      - and:\n        - description: magic initialization constants from MD4 and MD5\n        - number: 0x67452301 = A, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\n        - number: 0xefcdab89 = B, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\n        - number: 0x98badcfe = C, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\n        - number: 0x10325476 = D, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320\n        - not:\n          - number: 0xc3d2e1f0 = likely SHA1 but also used in RIPEMD-160 and RIPEMD-320\n        - optional:\n          - description: specific compilation from https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp\n          - and:\n            - offset: -0x28955B88\n            - offset: -0x173848AA\n      - basic block:\n        - and:\n          - number: 0x8003 = CALG_MD5\n          - api: advapi32.CryptCreateHash\n      - and:\n        - format: dotnet\n        - or:\n          - api: System.Security.Cryptography.MD5::Create\n          - api: System.Security.Cryptography.MD5CryptoServiceProvider::ctor\n        - optional:\n          - api: System.Security.Cryptography.HashAlgorithm::ComputeHash\n", "matches": [[{"type": "dn token", "value": 100663325}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "hash data with MD5/c06c94400ce64921b19a0b7407bdb50c"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "format", "format": "dotnet"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Security.Cryptography.MD5::Create"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663325, 0]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Security.Cryptography.MD5CryptoServiceProvider::ctor"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Security.Cryptography.HashAlgorithm::ComputeHash"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663325, 20]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and", "description": "magic initialization constants from MD4 and MD5"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 1732584193, "description": "A, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 4023233417, "description": "B, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 2562383102, "description": "C, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 271733878, "description": "D, also used in SHA1, RIPEMD-128, RIPEMD-160, RIPEMD-256, and RIPEMD-320"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "not"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "number", "number": 3285377520, "description": "likely SHA1 but also used in RIPEMD-160 and RIPEMD-320"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional", "description": "specific compilation from https://github.com/rwfpl/rewolf-x86-virtualizer/blob/master/src/test_app/main.cpp"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "offset", "offset": -680876936}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "offset", "offset": -389564586}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "decode data using Base64 in .NET": {"meta": {"name": "decode data using Base64 in .NET", "namespace": "data-manipulation/encoding/base64", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [{"parts": ["Defense Evasion", "Deobfuscate/Decode Files or Information"], "tactic": "Defense Evasion", "technique": "Deobfuscate/Decode Files or Information", "subtechnique": "", "id": "T1140"}], "mbc": [{"parts": ["Data", "Decode Data", "Base64"], "objective": "Data", "behavior": "Decode Data", "method": "Base64", "id": "C0053.001"}], "references": [], "examples": [], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: decode data using Base64 in .NET\n    namespace: data-manipulation/encoding/base64\n    authors:\n      - michael.hunhoff@mandiant.com\n    scope: function\n    att&ck:\n      - Defense Evasion::Deobfuscate/Decode Files or Information [T1140]\n    mbc:\n      - Data::Decode Data::Base64 [C0053.001]\n  features:\n    - or:\n      - api: System.Convert::FromBase64String\n      - api: System.Convert::FromBase64CharArray\n      - api: System.Convert::TryFromBase64Chars\n      - api: System.Convert::TryFromBase64String\n", "matches": [[{"type": "dn token", "value": 100663331}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Convert::FromBase64String"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663331, 12]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::FromBase64CharArray"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryFromBase64Chars"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Convert::TryFromBase64String"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "enumerate files on Windows": {"meta": {"name": "enumerate files on Windows", "namespace": "host-interaction/file-system/files/list", "authors": ["moritz.raabe@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "File and Directory Discovery"], "tactic": "Discovery", "technique": "File and Directory Discovery", "subtechnique": "", "id": "T1083"}], "mbc": [{"parts": ["Discovery", "File and Directory Discovery"], "objective": "Discovery", "behavior": "File and Directory Discovery", "method": "", "id": "E1083"}], "references": ["https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b5/Source/Furutaka/sup.c#L315"], "examples": ["Practical Malware Analysis Lab 01-01.exe_:0x4011E0", "Practical Malware Analysis Lab 20-02.exe_:0x401000", "563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x14000203C"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: enumerate files on Windows\n    namespace: host-interaction/file-system/files/list\n    authors:\n      - moritz.raabe@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::File and Directory Discovery [T1083]\n    mbc:\n      - Discovery::File and Directory Discovery [E1083]\n    references:\n      - https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b5/Source/Furutaka/sup.c#L315\n    examples:\n      - Practical Malware Analysis Lab 01-01.exe_:0x4011E0\n      - Practical Malware Analysis Lab 20-02.exe_:0x401000\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x14000203C\n  features:\n    - or:\n      - and:\n        - or:\n          - api: kernel32.FindFirstFile\n          - api: kernel32.FindFirstFileEx\n          - api: kernel32.FindFirstFileTransacted\n          - api: kernel32.FindFirstFileName\n          - api: kernel32.FindFirstFileNameTransacted\n        - or:\n          - api: kernel32.FindNextFile\n          - api: kernel32.FindNextFileName\n        - optional:\n          - api: kernel32.FindClose\n          - match: contain loop\n      - and:\n        - basic block:\n          - and:\n            - number: 1 = DIRECTORY_QUERY\n            - api: ntdll.NtOpenDirectoryObject\n        - api: ntdll.NtQueryDirectoryObject\n        - optional:\n          - api: RtlAllocateHeap\n          - match: contain loop\n          - characteristic: indirect call\n      - or:\n        - api: System.IO.DirectoryInfo::GetFiles\n        - api: System.IO.DirectoryInfo::EnumerateFiles\n        - api: System.IO.Directory::GetFiles\n        - api: System.IO.Directory::EnumerateFiles\n        - api: System.IO.Directory::EnumerateFileSystemEntries\n        - api: System.IO.DirectoryInfo::GetDirectories\n        - api: System.IO.DirectoryInfo::EnumerateDirectories\n        - api: System.IO.Directory::GetDirectories\n        - api: System.IO.Directory::EnumerateDirectories\n", "matches": [[{"type": "dn token", "value": 100663338}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "enumerate files on Windows/3a8b10ad7dbf4a54a4ca58e530c97dde"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtQueryDirectoryObject"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "RtlAllocateHeap"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "characteristic", "characteristic": "indirect call"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::GetFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::EnumerateFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::GetFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::EnumerateFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::EnumerateFileSystemEntries"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::GetDirectories"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663338, 6]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::EnumerateDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::GetDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::EnumerateDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileName"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileNameTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindNextFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindNextFileName"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindClose"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663339}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "enumerate files on Windows/3a8b10ad7dbf4a54a4ca58e530c97dde"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ntdll.NtQueryDirectoryObject"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "RtlAllocateHeap"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "characteristic", "characteristic": "indirect call"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::GetFiles"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663339, 6]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::EnumerateFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::GetFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::EnumerateFiles"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::EnumerateFileSystemEntries"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::GetDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::EnumerateDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::GetDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::EnumerateDirectories"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileName"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindFirstFileNameTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindNextFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindNextFileName"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.FindClose"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "contain loop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "get file size": {"meta": {"name": "get file size", "namespace": "host-interaction/file-system/meta", "authors": ["michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "File and Directory Discovery"], "tactic": "Discovery", "technique": "File and Directory Discovery", "subtechnique": "", "id": "T1083"}], "mbc": [{"parts": ["Discovery", "File and Directory Discovery"], "objective": "Discovery", "behavior": "File and Directory Discovery", "method": "", "id": "E1083"}], "references": [], "examples": ["mimikatz.exe_:0x40630D"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: get file size\n    namespace: host-interaction/file-system/meta\n    authors:\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::File and Directory Discovery [T1083]\n    mbc:\n      - Discovery::File and Directory Discovery [E1083]\n    examples:\n      - mimikatz.exe_:0x40630D\n  features:\n    - or:\n      - api: kernel32.GetFileSize\n      - api: kernel32.GetFileSizeEx\n      - property/read: System.IO.FileInfo::Length\n", "matches": [[{"type": "dn token", "value": 100663339}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetFileSize"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetFileSizeEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "read", "property": "System.IO.FileInfo::Length"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663339, 64]}], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetFileSize"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetFileSizeEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "read", "property": "System.IO.FileInfo::Length"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 599]}], "captures": {}}], "locations": [], "captures": {}}]]}, "delete file": {"meta": {"name": "delete file", "namespace": "host-interaction/file-system/delete", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["File System", "Delete File"], "objective": "File System", "behavior": "Delete File", "method": "", "id": "C0047"}], "references": [], "examples": ["946A99F36A46D335DEC080D9A4371940:0x100015F0", "31600AD0D1A7EA615690DF111AE36C73:0x401A15", "563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140001E04"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: delete file\n    namespace: host-interaction/file-system/delete\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - File System::Delete File [C0047]\n    examples:\n      - 946A99F36A46D335DEC080D9A4371940:0x100015F0\n      # MoveFileEx\n      - 31600AD0D1A7EA615690DF111AE36C73:0x401A15\n      # NtDeleteFile\n      - 563653399B82CD443F120ECEFF836EA3678D4CF11D9B351BB737573C2D856299:0x140001E04\n  features:\n    - or:\n      - api: kernel32.DeleteFile\n      - api: DeleteFileTransacted\n      - api: NtDeleteFile\n      - api: ZwDeleteFile\n      - api: remove\n      - api: _wremove\n      - api: System.IO.File::Delete\n      - api: System.IO.FileSystemInfo::Delete\n      - basic block:\n        - and:\n          - number: 3 = FO_DELETE\n          - or:\n            - api: kernel32.SHFileOperation\n      - basic block:\n        - and:\n          - number: 4 = MOVEFILE_DELAY_UNTIL_REBOOT\n          - number: 0 = NULL\n          - api: MoveFileEx\n", "matches": [[{"type": "dn token", "value": 100663344}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.DeleteFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "DeleteFileTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtDeleteFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwDeleteFile"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "remove"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_wremove"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.File::Delete"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663344, 6]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.FileSystemInfo::Delete"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "delete file/0f0cd8d783274dcd83357645c4ac5fc6"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "delete file/8deabcfbc57c4be3bc7873b94cc2f1d4"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "delete directory": {"meta": {"name": "delete directory", "namespace": "host-interaction/file-system/delete", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["File System", "Delete Directory"], "objective": "File System", "behavior": "Delete Directory", "method": "", "id": "C0048"}], "references": [], "examples": ["Practical Malware Analysis Lab 05-01.dll_:0x10009236", "AFB6EC3D721A5CB67863487B0E51A34C167F629CF701F8BC7A038C117B4DDA44:0x429AA0"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: delete directory\n    namespace: host-interaction/file-system/delete\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - File System::Delete Directory [C0048]\n    examples:\n      - Practical Malware Analysis Lab 05-01.dll_:0x10009236\n      - AFB6EC3D721A5CB67863487B0E51A34C167F629CF701F8BC7A038C117B4DDA44:0x429AA0\n  features:\n    - or:\n      - api: RemoveDirectory\n      - api: RemoveDirectoryTransacted\n      - api: _rmdir\n      - api: _wrmdir\n      - api: System.IO.DirectoryInfo::Delete\n      - api: System.IO.Directory::Delete\n", "matches": [[{"type": "dn token", "value": 100663349}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "RemoveDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RemoveDirectoryTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_rmdir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_wrmdir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::Delete"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.Directory::Delete"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663349, 7]}], "captures": {}}], "locations": [], "captures": {}}]]}, "create directory": {"meta": {"name": "create directory", "namespace": "host-interaction/file-system/create", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["File System", "Create Directory"], "objective": "File System", "behavior": "Create Directory", "method": "", "id": "C0046"}], "references": [], "examples": ["Practical Malware Analysis Lab 17-02.dll_:0x10008f62", "692f7fd6d198e804d6af98eb9e390d61:0x6000003"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create directory\n    namespace: host-interaction/file-system/create\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - File System::Create Directory [C0046]\n    examples:\n      - Practical Malware Analysis Lab 17-02.dll_:0x10008f62\n      - 692f7fd6d198e804d6af98eb9e390d61:0x6000003\n  features:\n    - or:\n      - api: kernel32.CreateDirectory\n      - api: kernel32.CreateDirectoryEx\n      - api: kernel32.CreateDirectoryTransacted\n      - api: NtCreateDirectoryObject\n      - api: ZwCreateDirectoryObject\n      - api: SHCreateDirectory\n      - api: SHCreateDirectoryEx\n      - api: _mkdir\n      - api: _wmkdir\n      - api: System.IO.Directory::CreateDirectory\n      - api: System.IO.DirectoryInfo::Create\n      - api: System.IO.DirectoryInfo::CreateSubdirectory\n", "matches": [[{"type": "dn token", "value": 100663354}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateDirectoryEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateDirectoryTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateDirectoryObject"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateDirectoryObject"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateDirectoryEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_mkdir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_wmkdir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.Directory::CreateDirectory"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663354, 6]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::Create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::CreateSubdirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663403}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateDirectoryEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateDirectoryTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateDirectoryObject"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateDirectoryObject"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHCreateDirectoryEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_mkdir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "_wmkdir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.Directory::CreateDirectory"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663403, 19]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::Create"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.DirectoryInfo::CreateSubdirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "query or enumerate registry key": {"meta": {"name": "query or enumerate registry key", "namespace": "host-interaction/registry", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "Query Registry"], "tactic": "Discovery", "technique": "Query Registry", "subtechnique": "", "id": "T1012"}], "mbc": [{"parts": ["Operating System", "Registry", "Query Registry Key"], "objective": "Operating System", "behavior": "Registry", "method": "Query Registry Key", "id": "C0036.005"}], "references": [], "examples": ["493167E85E45363D09495D0841C30648:0x404930", "B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402608"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: query or enumerate registry key\n    namespace: host-interaction/registry\n    authors:\n      - michael.hunhoff@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::Query Registry [T1012]\n    mbc:\n      - Operating System::Registry::Query Registry Key [C0036.005]\n    examples:\n      - 493167E85E45363D09495D0841C30648:0x404930\n      - B5F85C26D7AA5A1FB4AF5821B6B5AB9B:0x402608\n  features:\n    - and:\n      - optional:\n        - match: create or open registry key\n      - or:\n        - api: advapi32.RegEnumKey\n        - api: advapi32.RegEnumKeyEx\n        - api: advapi32.RegQueryInfoKeyA\n        - api: ZwQueryKey\n        - api: ZwEnumerateKey\n        - api: NtQueryKey\n        - api: NtEnumerateKey\n        - api: RtlCheckRegistryKey\n        - api: SHEnumKeyEx\n        - api: SHQueryInfoKey\n        - api: SHRegEnumUSKey\n        - api: SHRegQueryInfoUSKey\n        - api: Microsoft.Win32.RegistryKey::GetSubKeyNames\n        - api: Microsoft.Win32.RegistryKey::OpenBaseKey\n        - api: Microsoft.Win32.RegistryKey::OpenRemoteBaseKey\n        - api: Microsoft.Win32.RegistryKey::OpenSubKey\n", "matches": [[{"type": "dn token", "value": 100663394}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "create or open registry key"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenCurrentUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenUserClassesRoot"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegOpenUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegCreateUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663394, 11]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663394}], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegEnumKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegEnumKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegQueryInfoKeyA"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwQueryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwEnumerateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtQueryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtEnumerateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCheckRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHEnumKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHQueryInfoKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegEnumUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegQueryInfoUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetSubKeyNames"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663394, 11]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663395}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "create or open registry key"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenCurrentUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenUserClassesRoot"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegOpenUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegCreateUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663395, 30]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663395}], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegEnumKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegEnumKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegQueryInfoKeyA"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwQueryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwEnumerateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtQueryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtEnumerateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCheckRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHEnumKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHQueryInfoKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegEnumUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegQueryInfoUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetSubKeyNames"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663395, 6]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663395, 30]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "query or enumerate registry value": {"meta": {"name": "query or enumerate registry value", "namespace": "host-interaction/registry", "authors": ["william.ballenthin@mandiant.com", "michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "Query Registry"], "tactic": "Discovery", "technique": "Query Registry", "subtechnique": "", "id": "T1012"}], "mbc": [{"parts": ["Operating System", "Registry", "Query Registry Value"], "objective": "Operating System", "behavior": "Registry", "method": "Query Registry Value", "id": "C0036.006"}], "references": [], "examples": ["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A", "Practical Malware Analysis Lab 03-02.dll_:0x100047AD"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: query or enumerate registry value\n    namespace: host-interaction/registry\n    authors:\n      - william.ballenthin@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::Query Registry [T1012]\n    mbc:\n      - Operating System::Registry::Query Registry Value [C0036.006]\n    examples:\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145B5A\n      - Practical Malware Analysis Lab 03-02.dll_:0x100047AD\n  features:\n    - and:\n      - optional:\n        - match: create or open registry key\n      - or:\n        - api: advapi32.RegGetValue\n        - api: advapi32.RegEnumValue\n        - api: advapi32.RegQueryValue\n        - api: advapi32.RegQueryValueEx\n        - api: advapi32.RegQueryMultipleValues\n        - api: ZwQueryValueKey\n        - api: ZwEnumerateValueKey\n        - api: NtQueryValueKey\n        - api: NtEnumerateValueKey\n        - api: RtlQueryRegistryValues\n        - api: SHGetValue\n        - api: SHEnumValue\n        - api: SHRegGetInt\n        - api: SHRegGetPath\n        - api: SHRegGetValue\n        - api: SHQueryValueEx\n        - api: SHRegGetUSValue\n        - api: SHOpenRegStream\n        - api: SHRegEnumUSValue\n        - api: SHOpenRegStream2\n        - api: SHRegQueryUSValue\n        - api: SHRegGetBoolUSValue\n        - api: SHRegGetValueFromHKCUHKLM\n        - api: SHRegGetBoolValueFromHKCUHKLM\n        - api: Microsoft.Win32.RegistryKey::GetValue\n        - api: Microsoft.Win32.RegistryKey::GetValueKind\n        - api: Microsoft.Win32.RegistryKey::GetValueNames\n        - api: Microsoft.Win32.Registry::GetValue\n", "matches": [[{"type": "dn token", "value": 100663395}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "create or open registry key"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenCurrentUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegOpenUserClassesRoot"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwOpenKeyTransactedEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwCreateKeyTransacted"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtOpenKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtCreateKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegOpenUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegCreateUSKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlCreateRegistryKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenSubKey"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663395, 30]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::OpenRemoteBaseKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::CreateSubKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663395}], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegGetValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegEnumValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegQueryValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegQueryValueEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.RegQueryMultipleValues"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwQueryValueKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "ZwEnumerateValueKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtQueryValueKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "NtEnumerateValueKey"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "RtlQueryRegistryValues"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHGetValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHEnumValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetInt"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetPath"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHQueryValueEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetUSValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHOpenRegStream"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegEnumUSValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHOpenRegStream2"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegQueryUSValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetBoolUSValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetValueFromHKCUHKLM"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHRegGetBoolValueFromHKCUHKLM"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetValue"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663395, 117]}, {"type": "dn token offset", "value": [100663395, 141]}, {"type": "dn token offset", "value": [100663395, 69]}, {"type": "dn token offset", "value": [100663395, 93]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetValueKind"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.RegistryKey::GetValueNames"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "Microsoft.Win32.Registry::GetValue"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "get common file path": {"meta": {"name": "get common file path", "namespace": "host-interaction/file-system", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "File and Directory Discovery"], "tactic": "Discovery", "technique": "File and Directory Discovery", "subtechnique": "", "id": "T1083"}], "mbc": [{"parts": ["Discovery", "File and Directory Discovery"], "objective": "Discovery", "behavior": "File and Directory Discovery", "method": "", "id": "E1083"}], "references": [], "examples": ["Practical Malware Analysis Lab 03-02.dll_:0x10003415", "972B219F18379907A045431303F4DA7D:0x404887"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: get common file path\n    namespace: host-interaction/file-system\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::File and Directory Discovery [T1083]\n    mbc:\n      - Discovery::File and Directory Discovery [E1083]\n    examples:\n      - Practical Malware Analysis Lab 03-02.dll_:0x10003415\n      - 972B219F18379907A045431303F4DA7D:0x404887\n  features:\n    - or:\n      - api: kernel32.GetTempPath\n      - api: kernel32.GetTempFileName\n      - api: kernel32.GetSystemDirectory\n      - api: kernel32.GetWindowsDirectory\n      - api: kernel32.GetSystemWow64Directory\n      - api: GetAllUsersProfileDirectory\n      - api: GetAppContainerFolderPath\n      - api: GetCurrentDirectory\n      - api: GetDefaultUserProfileDirectory\n      - api: GetProfilesDirectory\n      - api: GetUserProfileDirectory\n      - api: SHGetFolderPathAndSubDir\n      - api: shell32.SHGetFolderPath\n      - api: shell32.SHGetFolderLocation\n      - api: shell32.SHGetSpecialFolderPath\n      - api: shell32.SHGetSpecialFolderLocation\n      - api: System.IO.Directory::GetCurrentDirectory\n      - api: System.Environment::GetFolderPath\n      - property/read: System.Environment::SystemDirectory\n      - property/read: System.Environment::CurrentDirectory\n", "matches": [[{"type": "dn token", "value": 100663401}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetTempPath"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetTempFileName"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetSystemDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetWindowsDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetSystemWow64Directory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "GetAllUsersProfileDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "GetAppContainerFolderPath"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "GetCurrentDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "GetDefaultUserProfileDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "GetProfilesDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "GetUserProfileDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "SHGetFolderPathAndSubDir"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.SHGetFolderPath"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.SHGetFolderLocation"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.SHGetSpecialFolderPath"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shell32.SHGetSpecialFolderLocation"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.IO.Directory::GetCurrentDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Environment::GetFolderPath"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663401, 3]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "read", "property": "System.Environment::SystemDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "read", "property": "System.Environment::CurrentDirectory"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "check if directory exists": {"meta": {"name": "check if directory exists", "namespace": "host-interaction/file-system/exists", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "File and Directory Discovery"], "tactic": "Discovery", "technique": "File and Directory Discovery", "subtechnique": "", "id": "T1083"}], "mbc": [], "references": [], "examples": [], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: check if directory exists\n    namespace: host-interaction/file-system/exists\n    authors:\n      - michael.hunhoff@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::File and Directory Discovery [T1083]\n  features:\n    - or:\n      - api: System.IO.Directory::Exists\n", "matches": [[{"type": "dn token", "value": 100663403}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.IO.Directory::Exists"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663403, 6]}], "captures": {}}], "locations": [], "captures": {}}]]}, "save image in .NET": {"meta": {"name": "save image in .NET", "namespace": "collection", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [], "references": [], "examples": [], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: save image in .NET\n    namespace: collection\n    authors:\n      - michael.hunhoff@mandiant.com\n    scope: function\n  features:\n    - and:\n      - api: System.Drawing.Image::Save\n      - optional:\n        - class: System.Drawing.Imaging.ImageFormat\n", "matches": [[{"type": "dn token", "value": 100663405}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Drawing.Image::Save"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663405, 17]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "class", "class_": "System.Drawing.Imaging.ImageFormat"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663405, 12]}], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "unmanaged call": {"meta": {"name": "unmanaged call", "namespace": "runtime", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [], "references": [], "examples": [], "description": "managed code calls unmanaged (native) code, often seen in .NET", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: unmanaged call\n    namespace: runtime\n    authors:\n      - michael.hunhoff@mandiant.com\n    description: managed code calls unmanaged (native) code, often seen in .NET\n    scope: function\n  features:\n    - or:\n      - characteristic: unmanaged call\n      - match: unmanaged call via dynamic PInvoke in .NET\n      - api: System.Runtime.InteropServices.Marshal::GetDelegateForFunctionPointer\n", "matches": [[{"type": "dn token", "value": 100663410}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "characteristic", "characteristic": "unmanaged call"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663410, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "unmanaged call via dynamic PInvoke in .NET"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Runtime.InteropServices.Marshal::GetDelegateForFunctionPointer"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663411}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "characteristic", "characteristic": "unmanaged call"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663411, 117]}, {"type": "dn token offset", "value": [100663411, 1]}, {"type": "dn token offset", "value": [100663411, 78]}, {"type": "dn token offset", "value": [100663411, 142]}, {"type": "dn token offset", "value": [100663411, 125]}, {"type": "dn token offset", "value": [100663411, 109]}, {"type": "dn token offset", "value": [100663411, 99]}, {"type": "dn token offset", "value": [100663411, 67]}, {"type": "dn token offset", "value": [100663411, 57]}, {"type": "dn token offset", "value": [100663411, 18]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "unmanaged call via dynamic PInvoke in .NET"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Runtime.InteropServices.Marshal::GetDelegateForFunctionPointer"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "capture screenshot": {"meta": {"name": "capture screenshot", "namespace": "collection/screenshot", "authors": ["moritz.raabe@mandiant.com", "@_re_fox", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [{"parts": ["Collection", "Screen Capture"], "tactic": "Collection", "technique": "Screen Capture", "subtechnique": "", "id": "T1113"}], "mbc": [{"parts": ["Collection", "Screen Capture", "WinAPI"], "objective": "Collection", "behavior": "Screen Capture", "method": "WinAPI", "id": "E1113.m01"}], "references": [], "examples": ["BFB9B5391A13D0AFD787E87AB90F14F5:0x1314610A", "7204e3efc2434012e13ca939db0d0b02:0x414070", "50D5EE1CE2CA5E30C6B1019EE64EEEC2:0x406E07"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: capture screenshot\n    namespace: collection/screenshot\n    authors:\n      - moritz.raabe@mandiant.com\n      - \"@_re_fox\"\n      - michael.hunhoff@mandiant.com\n    scope: function\n    att&ck:\n      - Collection::Screen Capture [T1113]\n    mbc:\n      - Collection::Screen Capture::WinAPI [E1113.m01]\n    examples:\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x1314610A\n      - 7204e3efc2434012e13ca939db0d0b02:0x414070\n      - 50D5EE1CE2CA5E30C6B1019EE64EEEC2:0x406E07\n  features:\n    - or:\n      - and:\n        - or:\n          - api: user32.GetWindowDC\n          - api: user32.GetDC\n          - and:\n            - api: gdi32.CreateDC\n            - string: \"DISPLAY\"\n        - or:\n          - api: gdi32.BitBlt\n          - api: gdi32.GetDIBits\n        - api: gdi32.CreateCompatibleDC\n        - api: gdi32.CreateCompatibleBitmap\n        - optional:\n          - or:\n            - api: user32.GetSystemMetrics = fetch screen dimensions\n            - api: user32.GetDesktopWindow = get entire desktop\n      - basic block:\n        - and:\n          - api: BitBlt\n          - characteristic: tight loop\n      - api: System.Drawing.Graphics::CopyFromScreen\n", "matches": [[{"type": "dn token", "value": 100663411}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "capture screenshot/924c3ba2321c4757bb47dd8d04d2544a"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Drawing.Graphics::CopyFromScreen"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "user32.GetWindowDC"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663411, 1]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "user32.GetDC"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "gdi32.CreateDC"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "string", "string": "DISPLAY"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "gdi32.BitBlt"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663411, 99]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "gdi32.GetDIBits"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "gdi32.CreateCompatibleDC"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663411, 57]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "gdi32.CreateCompatibleBitmap"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663411, 67]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "user32.GetSystemMetrics", "description": "fetch screen dimensions"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "user32.GetDesktopWindow", "description": "get entire desktop"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "create a process with modified I/O handles and window": {"meta": {"name": "create a process with modified I/O handles and window", "namespace": "host-interaction/process/create", "authors": ["matthew.williams@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Process", "Create Process"], "objective": "Process", "behavior": "Create Process", "method": "", "id": "C0017"}], "references": ["https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa"], "examples": ["Practical Malware Analysis Lab 14-02.exe_:0x4011C0"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create a process with modified I/O handles and window\n    namespace: host-interaction/process/create\n    authors:\n      - matthew.williams@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scope: function\n    mbc:\n      - Process::Create Process [C0017]\n    references:\n      - https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/ns-processthreadsapi-startupinfoa\n    examples:\n      - Practical Malware Analysis Lab 14-02.exe_:0x4011C0\n  features:\n    - or:\n      - and:\n        - or:\n          - description: API functions that accept a pointer to a STARTUPINFO structure\n          - api: kernel32.CreateProcess\n          - api: kernel32.CreateProcessInternal\n          - api: advapi32.CreateProcessAsUser\n          - api: advapi32.CreateProcessWithLogon\n          - api: advapi32.CreateProcessWithToken\n        - number: 0x101 = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW\n          # STARTF_USESTDHANDLES indicates the hStdInput, hStdOutput, and hStdError members contain additional information\n          # STARTF_USESHOWWINDOW indicates the wShowWindow member contains additional information\n        - or:\n          - and:\n            - arch: i386\n            - number: 0x44 = StartupInfo.cb (size)\n          - and:\n            - arch: amd64\n            - number: 0x68 = StartupInfo.cb (size)\n          # STARTUPINFOEX size values not currently supported by this rule.\n        - optional:\n          - api: kernel32.GetStartupInfo\n      - and:\n        - api: System.Diagnostics.Process::Start\n        - or:\n          - property/write: System.Diagnostics.ProcessStartInfo::UseShellExecute\n          - property/write: System.Diagnostics.ProcessStartInfo::Verb\n          - property/write: System.Diagnostics.ProcessStartInfo::WindowStyle\n          - property/write: System.Diagnostics.ProcessStartInfo::WorkingDirectory\n          - property/write: System.Diagnostics.ProcessStartInfo::FileName\n          - property/write: System.Diagnostics.ProcessStartInfo::Arguments\n          - property/write: System.Diagnostics.ProcessStartInfo::CreateNoWindow\n          - property/write: System.Diagnostics.ProcessStartInfo::RedirectStandardOutput\n          - property/write: System.Diagnostics.ProcessStartInfo::RedirectStandardInput\n          - property/read: System.Diagnostics.Process::StandardOutput\n          - property/read: System.Diagnostics.Process::StandardInput\n", "matches": [[{"type": "dn token", "value": 100663425}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Diagnostics.Process::Start"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 178]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::UseShellExecute"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 122]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::Verb"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::WindowStyle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::WorkingDirectory"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 150]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::FileName"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 74]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::Arguments"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::CreateNoWindow"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 134]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::RedirectStandardOutput"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 98]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Diagnostics.ProcessStartInfo::RedirectStandardInput"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663425, 86]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "read", "property": "System.Diagnostics.Process::StandardOutput"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "read", "property": "System.Diagnostics.Process::StandardInput"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or", "description": "API functions that accept a pointer to a STARTUPINFO structure"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateProcess"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.CreateProcessInternal"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessAsUser"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessWithLogon"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "advapi32.CreateProcessWithToken"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 257, "description": "STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "arch", "arch": "i386"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 68, "description": "StartupInfo.cb (size)"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "arch", "arch": "amd64"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 104, "description": "StartupInfo.cb (size)"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetStartupInfo"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "act as TCP client": {"meta": {"name": "act as TCP client", "namespace": "communication/tcp/client", "authors": ["william.ballenthin@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Communication", "Socket Communication", "TCP Client"], "objective": "Communication", "behavior": "Socket Communication", "method": "TCP Client", "id": "C0001.008"}], "references": [], "examples": ["Practical Malware Analysis Lab 01-01.dll_:0x10001010"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: act as TCP client\n    namespace: communication/tcp/client\n    authors:\n      - william.ballenthin@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - Communication::Socket Communication::TCP Client [C0001.008]\n    examples:\n      - Practical Malware Analysis Lab 01-01.dll_:0x10001010\n  features:\n    - or:\n      - match: connect TCP socket\n      - api: System.Net.Sockets.TcpClient::ctor\n", "matches": [[{"type": "dn token", "value": 100663434}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "connect TCP socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Net.Sockets.TcpClient::ctor"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663434, 38]}], "captures": {}}], "locations": [], "captures": {}}]]}, "send request in .NET": {"meta": {"name": "send request in .NET", "namespace": "communication/http/client", "authors": ["anushka.virgaonakr@mandiant.com"], "scope": "function", "attack": [{"parts": ["Command and Control", "Application Layer Protocol", "Web Protocols"], "tactic": "Command and Control", "technique": "Application Layer Protocol", "subtechnique": "Web Protocols", "id": "T1071.001"}], "mbc": [{"parts": ["Communication", "HTTP Communication", "Send Request"], "objective": "Communication", "behavior": "HTTP Communication", "method": "Send Request", "id": "C0002.003"}], "references": [], "examples": [], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: send request in .NET\n    namespace: communication/http/client\n    authors:\n      - anushka.virgaonakr@mandiant.com\n    scope: function\n    att&ck:\n      - Command and Control::Application Layer Protocol::Web Protocols [T1071.001]\n    mbc:\n      - Communication::HTTP Communication::Send Request [C0002.003]\n  features:\n    - and:\n      - or:\n        - api: System.Net.WebRequest::GetRequestStream\n        - api: System.Net.WebRequest::GetRequestStreamAsync\n        - and:\n          - api: System.Net.WebRequest::BeginGetRequestStream\n          - api: System.Net.WebRequest::EndGetRequestStream\n      - api: System.IO.Stream::Write\n      - api: System.IO.Stream::Close\n", "matches": [[{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.IO.Stream::Write"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 833]}, {"type": "dn token offset", "value": [100663446, 788]}, {"type": "dn token offset", "value": [100663446, 688]}, {"type": "dn token offset", "value": [100663446, 1122]}, {"type": "dn token offset", "value": [100663446, 1212]}, {"type": "dn token offset", "value": [100663446, 977]}, {"type": "dn token offset", "value": [100663446, 1108]}, {"type": "dn token offset", "value": [100663446, 802]}, {"type": "dn token offset", "value": [100663446, 847]}, {"type": "dn token offset", "value": [100663446, 1181]}, {"type": "dn token offset", "value": [100663446, 991]}, {"type": "dn token offset", "value": [100663446, 1049]}], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.Stream::Close"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 1226]}, {"type": "dn token offset", "value": [100663446, 1279]}, {"type": "dn token offset", "value": [100663446, 1077]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetRequestStream"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 672]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetRequestStreamAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::BeginGetRequestStream"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::EndGetRequestStream"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "receive HTTP response": {"meta": {"name": "receive HTTP response", "namespace": "communication/http/client", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Communication", "HTTP Communication", "Get Response"], "objective": "Communication", "behavior": "HTTP Communication", "method": "Get Response", "id": "C0002.017"}], "references": [], "examples": ["6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10002790"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: receive HTTP response\n    namespace: communication/http/client\n    authors:\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - Communication::HTTP Communication::Get Response [C0002.017]\n    examples:\n      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x10002790\n  features:\n    - or:\n      - api: System.Net.WebRequest::GetResponse\n      - api: winhttp.WinHttpReceiveResponse\n      - and:\n        - api: winhttp.WinHttpReadData\n        - optional:\n          - api: winhttp.WinHttpQueryDataAvailable\n", "matches": [[{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 1232]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpReceiveResponse"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpReadData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpQueryDataAvailable"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663451}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 124]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpReceiveResponse"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpReadData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpQueryDataAvailable"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "create HTTP request": {"meta": {"name": "create HTTP request", "namespace": "communication/http/client", "authors": ["michael.hunhoff@mandiant.com", "anushka.virgaonkar@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Communication", "HTTP Communication", "Create Request"], "objective": "Communication", "behavior": "HTTP Communication", "method": "Create Request", "id": "C0002.012"}], "references": [], "examples": ["6f99a2c8944cb02ff28c6f9ced59b161:0x40E2F0"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: create HTTP request\n    namespace: communication/http/client\n    authors:\n      - michael.hunhoff@mandiant.com\n      - anushka.virgaonkar@mandiant.com\n    scope: function\n    mbc:\n      - Communication::HTTP Communication::Create Request [C0002.012]\n    examples:\n      - 6f99a2c8944cb02ff28c6f9ced59b161:0x40E2F0\n  features:\n    - and:\n      - or:\n        - api: wininet.InternetOpen\n        - api: System.Net.WebRequest::Create\n        - api: System.Net.WebRequest::CreateDefault\n        - api: System.Net.WebRequest::CreateHttp\n      - optional:\n        - api: wininet.InternetCloseHandle\n", "matches": [[{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetCloseHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetOpen"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::Create"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 7]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::CreateDefault"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::CreateHttp"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663451}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetCloseHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetOpen"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::Create"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 110]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::CreateDefault"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::CreateHttp"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "send HTTP request": {"meta": {"name": "send HTTP request", "namespace": "communication/http/client", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Communication", "HTTP Communication", "Send Request"], "objective": "Communication", "behavior": "HTTP Communication", "method": "Send Request", "id": "C0002.003"}], "references": [], "examples": ["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60", "6A352C3E55E8AE5ED39DC1BE7FB964B1:0x100026E0"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: send HTTP request\n    namespace: communication/http/client\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - Communication::HTTP Communication::Send Request [C0002.003]\n    examples:\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\n      - 6A352C3E55E8AE5ED39DC1BE7FB964B1:0x100026E0\n  features:\n    - or:\n      - api: System.Net.WebRequest::GetResponse\n      - api: System.Net.WebRequest::GetResponseAsync\n      - and:\n        - or:\n          - api: wininet.HttpOpenRequest\n          - api: wininet.InternetConnect\n        - or:\n          - api: wininet.HttpSendRequest\n          - api: wininet.HttpSendRequestEx\n      - and:\n        - api: winhttp.WinHttpSendRequest\n        - api: winhttp.WinHttpWriteData\n        - optional:\n          - or:\n            - api: winhttp.WinHttpOpenRequest\n            - api: winhttp.WinHttpConnect\n      - and:\n        - match: send data on socket\n        - string: /HTTP/i\n", "matches": [[{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 1232]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponseAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "regex", "regex": "/HTTP/i"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequestEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpWriteData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663451}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 124]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponseAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "regex", "regex": "/HTTP/i"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequestEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpWriteData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "send data": {"meta": {"name": "send data", "namespace": "communication", "authors": ["william.ballenthin@mandiant.com", "joakim@intezer.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Command and Control", "C2 Communication", "Send Data"], "objective": "Command and Control", "behavior": "C2 Communication", "method": "Send Data", "id": "B0030.001"}], "references": [], "examples": ["BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60"], "description": "all known techniques for sending data to a potential C2 server", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: send data\n    namespace: communication\n    authors:\n      - william.ballenthin@mandiant.com\n      - joakim@intezer.com\n    description: all known techniques for sending data to a potential C2 server\n    scope: function\n    mbc:\n      - Command and Control::C2 Communication::Send Data [B0030.001]\n    examples:\n      - BFB9B5391A13D0AFD787E87AB90F14F5:0x13145D60\n  features:\n    - or:\n      - and:\n        - os: windows\n        - or:\n          - match: send HTTP request\n          - match: send data on socket\n          - match: send file via HTTP\n      - and:\n        - os: linux\n        - or: # Require network bound socket.\n          - match: create TCP socket\n          - match: create UDP socket\n        - or:\n          - match: send HTTP request\n          - match: send data on socket\n          - match: send file via HTTP\n", "matches": [[{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "send HTTP request"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 1232]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponseAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "regex", "regex": "/HTTP/i"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequestEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpWriteData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663446}], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send file via HTTP"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "create TCP socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "create UDP socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "send HTTP request"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 1232]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponseAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "regex", "regex": "/HTTP/i"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequestEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpWriteData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663446}], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send file via HTTP"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], [{"type": "dn token", "value": 100663451}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "windows"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "send HTTP request"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 124]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponseAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "regex", "regex": "/HTTP/i"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequestEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpWriteData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663451}], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send file via HTTP"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "os", "os": "linux"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "create TCP socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "create UDP socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "match", "match": "send HTTP request"}, "type": "feature"}, "children": [{"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponse"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 124]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebRequest::GetResponseAsync"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "regex", "regex": "/HTTP/i"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.InternetConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "wininet.HttpSendRequestEx"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpSendRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpWriteData"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpOpenRequest"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "winhttp.WinHttpConnect"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [{"type": "dn token", "value": 100663451}], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send data on socket"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "send file via HTTP"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "set web proxy in .NET": {"meta": {"name": "set web proxy in .NET", "namespace": "communication/http", "authors": ["michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [], "references": [], "examples": [], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: set web proxy in .NET\n    namespace: communication/http\n    authors:\n      - michael.hunhoff@mandiant.com\n    scope: function\n  features:\n    - and:\n      - property/write: System.Net.WebRequest::Proxy\n      - optional:\n        - api: System.Net.WebProxy::ctor\n", "matches": [[{"type": "dn token", "value": 100663446}, {"success": true, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "property", "access": "write", "property": "System.Net.WebRequest::Proxy"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663446, 32]}], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "System.Net.WebProxy::ctor"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "manipulate console buffer": {"meta": {"name": "manipulate console buffer", "namespace": "host-interaction/console", "authors": ["william.ballenthin@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [], "mbc": [{"parts": ["Operating System", "Console"], "objective": "Operating System", "behavior": "Console", "method": "", "id": "C0033"}], "references": ["https://stackoverflow.com/a/15770935/87207"], "examples": ["3aa7ee4d67f562933bc998f352b1f319:0x705413A0"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: manipulate console buffer\n    namespace: host-interaction/console\n    authors:\n      - william.ballenthin@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    mbc:\n      - Operating System::Console [C0033]\n    references:\n      - https://stackoverflow.com/a/15770935/87207\n    examples:\n      - 3aa7ee4d67f562933bc998f352b1f319:0x705413A0\n  features:\n    - or:\n      - and:\n        - or:\n          - api: kernel32.SetConsoleCursorPosition\n          - api: kernel32.ReadConsoleOutputCharacter\n          - api: kernel32.WriteConsoleOutputCharacter\n          - api: kernel32.WriteConsoleOutput\n          - api: kernel32.WriteConsoleInput\n        - optional:\n          - api: kernel32.GetStdHandle\n          - number: 0xfffffff5 = STD_OUTPUT_HANDLE\n      - api: System.Console::Write\n      - api: System.Console::WriteLine\n", "matches": [[{"type": "dn token", "value": 100663451}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "System.Console::Write"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.Console::WriteLine"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 44]}], "captures": {}}, {"success": false, "node": {"statement": {"type": "and"}, "type": "statement"}, "children": [{"success": false, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.SetConsoleCursorPosition"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.ReadConsoleOutputCharacter"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.WriteConsoleOutputCharacter"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.WriteConsoleOutput"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "kernel32.WriteConsoleInput"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}, {"success": true, "node": {"statement": {"type": "optional"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "api", "api": "kernel32.GetStdHandle"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "number", "number": 4294967285, "description": "STD_OUTPUT_HANDLE"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "check if file exists": {"meta": {"name": "check if file exists", "namespace": "host-interaction/file-system/exists", "authors": ["moritz.raabe@mandiant.com", "michael.hunhoff@mandiant.com"], "scope": "function", "attack": [{"parts": ["Discovery", "File and Directory Discovery"], "tactic": "Discovery", "technique": "File and Directory Discovery", "subtechnique": "", "id": "T1083"}], "mbc": [{"parts": ["Discovery", "File and Directory Discovery"], "objective": "Discovery", "behavior": "File and Directory Discovery", "method": "", "id": "E1083"}], "references": [], "examples": ["31600AD0D1A7EA615690DF111AE36C73:0x401284"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: check if file exists\n    namespace: host-interaction/file-system/exists\n    authors:\n      - moritz.raabe@mandiant.com\n      - michael.hunhoff@mandiant.com\n    scope: function\n    att&ck:\n      - Discovery::File and Directory Discovery [T1083]\n    mbc:\n      - Discovery::File and Directory Discovery [E1083]\n    examples:\n      - 31600AD0D1A7EA615690DF111AE36C73:0x401284\n  features:\n    - or:\n      - basic block:\n        - and:\n          - api: kernel32.GetFileAttributes\n          - instruction:\n            - mnemonic: cmp\n            - number: 0xFFFFFFFF = INVALID_FILE_ATTRIBUTES\n      - basic block:\n        - and:\n          - api: kernel32.GetLastError\n          - instruction:\n            - mnemonic: cmp\n            - number: 2 = ERROR_FILE_NOT_FOUND\n      - api: shlwapi.PathFileExists\n      - api: System.IO.File::Exists\n      - property/read: System.IO.FileSystemInfo::Exists\n", "matches": [[{"type": "dn token", "value": 100663451}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": false, "node": {"feature": {"type": "match", "match": "check if file exists/1ea47bdc82bf43a4944786fc47dd1a67"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "match", "match": "check if file exists/365eac8ed9a7465fa523bb7b444ec341"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "api", "api": "shlwapi.PathFileExists"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": true, "node": {"feature": {"type": "api", "api": "System.IO.File::Exists"}, "type": "feature"}, "children": [], "locations": [{"type": "dn token offset", "value": [100663451, 82]}], "captures": {}}, {"success": false, "node": {"feature": {"type": "property", "access": "read", "property": "System.IO.FileSystemInfo::Exists"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}, "compiled to the .NET platform": {"meta": {"name": "compiled to the .NET platform", "namespace": "runtime/dotnet", "authors": ["william.ballenthin@mandiant.com"], "scope": "file", "attack": [], "mbc": [], "references": [], "examples": ["b9f5bd514485fb06da39beff051b9fdc"], "description": "", "lib": false, "is_subscope_rule": false, "maec": {}}, "source": "rule:\n  meta:\n    name: compiled to the .NET platform\n    namespace: runtime/dotnet\n    authors:\n      - william.ballenthin@mandiant.com\n    scope: file\n    examples:\n      - b9f5bd514485fb06da39beff051b9fdc\n  features:\n    - or:\n      - format: dotnet\n      - import: mscoree._CorExeMain\n      - import: mscoree._corexemain\n      - import: mscoree._CorDllMain\n      - import: mscoree._cordllmain\n", "matches": [[{"type": "no address"}, {"success": true, "node": {"statement": {"type": "or"}, "type": "statement"}, "children": [{"success": true, "node": {"feature": {"type": "format", "format": "dotnet"}, "type": "feature"}, "children": [], "locations": [{"type": "no address"}], "captures": {}}, {"success": false, "node": {"feature": {"type": "import", "import_": "mscoree._CorExeMain"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "import", "import_": "mscoree._corexemain"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "import", "import_": "mscoree._CorDllMain"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}, {"success": false, "node": {"feature": {"type": "import", "import_": "mscoree._cordllmain"}, "type": "feature"}, "children": [], "locations": [], "captures": {}}], "locations": [], "captures": {}}]]}}}
